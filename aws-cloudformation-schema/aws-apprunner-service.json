{
  "tagging" : {
    "taggable" : true,
    "tagOnCreate" : true,
    "tagUpdatable" : false,
    "tagProperty" : "/properties/Tags",
    "cloudFormationSystemTags" : false
  },
  "typeName" : "AWS::AppRunner::Service",
  "readOnlyProperties" : [ "/properties/ServiceArn", "/properties/ServiceId", "/properties/ServiceUrl", "/properties/Status" ],
  "description" : "The AWS::AppRunner::Service resource specifies an AppRunner Service.",
  "createOnlyProperties" : [ "/properties/ServiceName", "/properties/EncryptionConfiguration", "/properties/Tags" ],
  "primaryIdentifier" : [ "/properties/ServiceArn" ],
  "required" : [ "SourceConfiguration" ],
  "sourceUrl" : "https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-apprunner.git",
  "handlers" : {
    "read" : {
      "permissions" : [ "apprunner:DescribeService" ]
    },
    "create" : {
      "permissions" : [ "apprunner:CreateService", "apprunner:TagResource", "iam:PassRole", "iam:CreateServiceLinkedRole", "logs:CreateLogGroup", "logs:PutRetentionPolicy", "logs:CreateLogStream", "logs:PutLogEvents", "logs:DescribeLogStreams", "events:PutRule", "events:PutTargets" ]
    },
    "update" : {
      "permissions" : [ "apprunner:UpdateService", "iam:PassRole" ]
    },
    "list" : {
      "permissions" : [ "apprunner:ListServices", "iam:PassRole" ]
    },
    "delete" : {
      "permissions" : [ "apprunner:DeleteService" ]
    }
  },
  "writeOnlyProperties" : [ "/properties/Tags", "/properties/AutoScalingConfigurationArn" ],
  "additionalProperties" : false,
  "definitions" : {
    "AuthenticationConfiguration" : {
      "description" : "Authentication Configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "AccessRoleArn" : {
          "description" : "Access Role Arn",
          "$ref" : "#/definitions/RoleArn"
        },
        "ConnectionArn" : {
          "minLength" : 1,
          "pattern" : "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}",
          "description" : "Connection Arn",
          "type" : "string",
          "maxLength" : 1011
        }
      }
    },
    "SourceCodeVersion" : {
      "description" : "Source Code Version",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "Type" : {
          "description" : "Source Code Version Type",
          "type" : "string",
          "enum" : [ "BRANCH" ]
        },
        "Value" : {
          "description" : "Source Code Version Value",
          "type" : "string"
        }
      },
      "required" : [ "Type", "Value" ]
    },
    "CodeRepository" : {
      "description" : "Source Code Repository",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "SourceCodeVersion" : {
          "$ref" : "#/definitions/SourceCodeVersion"
        },
        "CodeConfiguration" : {
          "$ref" : "#/definitions/CodeConfiguration"
        },
        "RepositoryUrl" : {
          "description" : "Repository Url",
          "type" : "string"
        }
      },
      "required" : [ "RepositoryUrl", "SourceCodeVersion" ]
    },
    "KeyValuePair" : {
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "Value" : {
          "type" : "string"
        },
        "Name" : {
          "type" : "string"
        }
      }
    },
    "InstanceConfiguration" : {
      "description" : "Instance Configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "InstanceRoleArn" : {
          "description" : "Instance Role Arn",
          "$ref" : "#/definitions/RoleArn"
        },
        "Memory" : {
          "minLength" : 4,
          "pattern" : "2048|3072|4096|(2|3|4) GB",
          "description" : "Memory",
          "type" : "string",
          "maxLength" : 4
        },
        "Cpu" : {
          "minLength" : 4,
          "pattern" : "1024|2048|(1|2) vCPU",
          "description" : "CPU",
          "type" : "string",
          "maxLength" : 6
        }
      }
    },
    "EncryptionConfiguration" : {
      "description" : "Encryption configuration (KMS key)",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "KmsKey" : {
          "minLength" : 0,
          "pattern" : "arn:aws(-[\\w]+)*:kms:[a-z\\-]+-[0-9]{1}:[0-9]{12}:key\\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}",
          "description" : "The KMS Key",
          "type" : "string",
          "maxLength" : 256
        }
      },
      "required" : [ "KmsKey" ]
    },
    "IngressConfiguration" : {
      "description" : "Network ingress configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "IsPubliclyAccessible" : {
          "description" : "It's set to true if the Apprunner service is publicly accessible. It's set to false otherwise.",
          "type" : "boolean"
        }
      },
      "required" : [ "IsPubliclyAccessible" ]
    },
    "RoleArn" : {
      "minLength" : 29,
      "pattern" : "arn:(aws|aws-us-gov|aws-cn|aws-iso|aws-iso-b):iam::[0-9]{12}:role/[\\w+=,.@-]{1,64}",
      "type" : "string",
      "maxLength" : 1024
    },
    "ServiceObservabilityConfiguration" : {
      "description" : "Service observability configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "ObservabilityEnabled" : {
          "description" : "Observability enabled",
          "type" : "boolean"
        },
        "ObservabilityConfigurationArn" : {
          "minLength" : 1,
          "pattern" : "arn:aws(-[\\w]+)*:[a-z0-9-\\.]{0,63}:[a-z0-9-\\.]{0,63}:[0-9]{12}:(\\w|/|-){1,1011}",
          "description" : "The Amazon Resource Name (ARN) of the App Runner ObservabilityConfiguration.",
          "type" : "string",
          "maxLength" : 1011
        }
      },
      "required" : [ "ObservabilityEnabled" ]
    },
    "CodeConfigurationValues" : {
      "description" : "Code Configuration Values",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "Runtime" : {
          "description" : "Runtime",
          "type" : "string",
          "enum" : [ "PYTHON_3", "NODEJS_12", "NODEJS_14", "CORRETTO_8", "CORRETTO_11", "NODEJS_16", "GO_1", "DOTNET_6", "PHP_81", "RUBY_31" ]
        },
        "StartCommand" : {
          "description" : "Start Command",
          "type" : "string"
        },
        "RuntimeEnvironmentVariables" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/definitions/KeyValuePair"
          }
        },
        "Port" : {
          "description" : "Port",
          "type" : "string"
        },
        "BuildCommand" : {
          "description" : "Build Command",
          "type" : "string"
        }
      },
      "required" : [ "Runtime" ]
    },
    "HealthCheckConfiguration" : {
      "description" : "Health check configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "Path" : {
          "description" : "Health check Path",
          "type" : "string"
        },
        "UnhealthyThreshold" : {
          "description" : "Health check Unhealthy Threshold",
          "maximum" : 20,
          "type" : "integer",
          "minimum" : 1
        },
        "Timeout" : {
          "description" : "Health check Timeout",
          "maximum" : 20,
          "type" : "integer",
          "minimum" : 1
        },
        "HealthyThreshold" : {
          "description" : "Health check Healthy Threshold",
          "maximum" : 20,
          "type" : "integer",
          "minimum" : 1
        },
        "Protocol" : {
          "description" : "Health Check Protocol",
          "type" : "string",
          "enum" : [ "TCP", "HTTP" ]
        },
        "Interval" : {
          "description" : "Health check Interval",
          "type" : "integer"
        }
      }
    },
    "CodeConfiguration" : {
      "description" : "Code Configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "ConfigurationSource" : {
          "description" : "Configuration Source",
          "type" : "string",
          "enum" : [ "REPOSITORY", "API" ]
        },
        "CodeConfigurationValues" : {
          "$ref" : "#/definitions/CodeConfigurationValues"
        }
      },
      "required" : [ "ConfigurationSource" ]
    },
    "EgressConfiguration" : {
      "description" : "Network egress configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "VpcConnectorArn" : {
          "minLength" : 44,
          "pattern" : "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}",
          "description" : "The Amazon Resource Name (ARN) of the App Runner VpcConnector.",
          "type" : "string",
          "maxLength" : 1011
        },
        "EgressType" : {
          "description" : "Network egress type.",
          "type" : "string",
          "enum" : [ "DEFAULT", "VPC" ]
        }
      },
      "required" : [ "EgressType" ]
    },
    "ImageConfiguration" : {
      "description" : "Image Configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "StartCommand" : {
          "description" : "Start Command",
          "type" : "string"
        },
        "RuntimeEnvironmentVariables" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/definitions/KeyValuePair"
          }
        },
        "Port" : {
          "description" : "Port",
          "type" : "string"
        }
      }
    },
    "ImageRepository" : {
      "description" : "Image Repository",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "ImageIdentifier" : {
          "minLength" : 1,
          "pattern" : "([0-9]{12}.dkr.ecr.[a-z\\-]+-[0-9]{1}.amazonaws.com\\/.*)|(^public\\.ecr\\.aws\\/.+\\/.+)",
          "description" : "Image Identifier",
          "type" : "string",
          "maxLength" : 1024
        },
        "ImageConfiguration" : {
          "$ref" : "#/definitions/ImageConfiguration"
        },
        "ImageRepositoryType" : {
          "description" : "Image Repository Type",
          "type" : "string",
          "enum" : [ "ECR", "ECR_PUBLIC" ]
        }
      },
      "required" : [ "ImageIdentifier", "ImageRepositoryType" ]
    },
    "SourceConfiguration" : {
      "description" : "Source Code configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "AuthenticationConfiguration" : {
          "$ref" : "#/definitions/AuthenticationConfiguration"
        },
        "CodeRepository" : {
          "$ref" : "#/definitions/CodeRepository"
        },
        "ImageRepository" : {
          "$ref" : "#/definitions/ImageRepository"
        },
        "AutoDeploymentsEnabled" : {
          "description" : "Auto Deployment enabled",
          "type" : "boolean"
        }
      }
    },
    "NetworkConfiguration" : {
      "description" : "Network configuration",
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "EgressConfiguration" : {
          "$ref" : "#/definitions/EgressConfiguration"
        },
        "IngressConfiguration" : {
          "$ref" : "#/definitions/IngressConfiguration"
        }
      }
    },
    "Tag" : {
      "additionalProperties" : false,
      "type" : "object",
      "properties" : {
        "Value" : {
          "type" : "string"
        },
        "Key" : {
          "type" : "string"
        }
      }
    }
  },
  "properties" : {
    "Status" : {
      "description" : "AppRunner Service status.",
      "type" : "string"
    },
    "InstanceConfiguration" : {
      "$ref" : "#/definitions/InstanceConfiguration"
    },
    "EncryptionConfiguration" : {
      "$ref" : "#/definitions/EncryptionConfiguration"
    },
    "ObservabilityConfiguration" : {
      "$ref" : "#/definitions/ServiceObservabilityConfiguration"
    },
    "ServiceArn" : {
      "minLength" : 1,
      "pattern" : "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}",
      "description" : "The Amazon Resource Name (ARN) of the AppRunner Service.",
      "type" : "string",
      "maxLength" : 1011
    },
    "ServiceId" : {
      "minLength" : 32,
      "description" : "The AppRunner Service Id",
      "type" : "string",
      "maxLength" : 32
    },
    "HealthCheckConfiguration" : {
      "$ref" : "#/definitions/HealthCheckConfiguration"
    },
    "ServiceName" : {
      "minLength" : 4,
      "pattern" : "[A-Za-z0-9][A-Za-z0-9-_]{3,39}",
      "description" : "The AppRunner Service Name.",
      "type" : "string",
      "maxLength" : 40
    },
    "SourceConfiguration" : {
      "$ref" : "#/definitions/SourceConfiguration"
    },
    "ServiceUrl" : {
      "description" : "The Service Url of the AppRunner Service.",
      "type" : "string"
    },
    "AutoScalingConfigurationArn" : {
      "minLength" : 1,
      "pattern" : "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}",
      "description" : "Autoscaling configuration ARN",
      "type" : "string",
      "maxLength" : 1011
    },
    "NetworkConfiguration" : {
      "$ref" : "#/definitions/NetworkConfiguration"
    },
    "Tags" : {
      "type" : "array",
      "items" : {
        "$ref" : "#/definitions/Tag"
      }
    }
  }
}